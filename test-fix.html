<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix - BMW Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Fix - BMW Data</h1>
        
        <div class="status">
            <strong>‚úÖ Fix Applied:</strong><br>
            - Added setArticles import<br>
            - Fixed data transformation<br>
            - Articles now match NewsArticle interface<br>
            - Dashboard should display BMW articles
        </div>
        
        <p><strong>üéØ Test:</strong> Add BMW data and verify it appears in the dashboard.</p>
        
        <button onclick="addBMWData()">üöó Add BMW Data</button>
        <button onclick="goToDashboard()">üìà Test Dashboard</button>
        <button onclick="checkData()">üîç Check Data</button>
        
        <div id="result"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        function addBMWData() {
            try {
                const bmwData = [
                    {
                        keyword: "bmw",
                        newsData: {
                            results: [
                                {
                                    id: "bmw1",
                                    title: "BMW Unveils Revolutionary Electric Vehicle Technology",
                                    description: "BMW has announced breakthrough battery technology that promises to revolutionize the electric vehicle market.",
                                    url: "https://example.com/bmw-electric",
                                    publishedAt: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
                                    source: { 
                                        name: "Auto News Daily",
                                        logo: "https://via.placeholder.com/50x50/007bff/ffffff?text=AND"
                                    },
                                    image: "https://via.placeholder.com/400x200/007bff/ffffff?text=BMW+Electric",
                                    sentiment: { score: 18, label: "positive" },
                                    readTime: 6,
                                    isBreaking: true,
                                    categories: ["Automotive", "Technology"],
                                    topics: ["Electric Vehicles", "Innovation"],
                                    engagement: { views: 1850, shares: 67, comments: 34 }
                                },
                                {
                                    id: "bmw2",
                                    title: "BMW Reports Record Sales in Q4 2024",
                                    description: "BMW has reported its highest quarterly sales figures in company history.",
                                    url: "https://example.com/bmw-sales",
                                    publishedAt: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(),
                                    source: { 
                                        name: "Business Automotive",
                                        logo: "https://via.placeholder.com/50x50/28a745/ffffff?text=BA"
                                    },
                                    image: "https://via.placeholder.com/400x200/28a745/ffffff?text=BMW+Sales",
                                    sentiment: { score: 12, label: "positive" },
                                    readTime: 4,
                                    isBreaking: false,
                                    categories: ["Business", "Automotive"],
                                    topics: ["Sales", "Financial Results"],
                                    engagement: { views: 1200, shares: 45, comments: 23 }
                                },
                                {
                                    id: "bmw3",
                                    title: "BMW Recalls 50,000 Vehicles Over Safety Concerns",
                                    description: "BMW has issued a voluntary recall for approximately 50,000 vehicles due to potential brake system issues.",
                                    url: "https://example.com/bmw-recall",
                                    publishedAt: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                                    source: { 
                                        name: "Safety First News",
                                        logo: "https://via.placeholder.com/50x50/dc3545/ffffff?text=SFN"
                                    },
                                    image: "https://via.placeholder.com/400x200/dc3545/ffffff?text=BMW+Recall",
                                    sentiment: { score: -8, label: "negative" },
                                    readTime: 5,
                                    isBreaking: true,
                                    categories: ["Safety", "Automotive"],
                                    topics: ["Recall", "Safety"],
                                    engagement: { views: 2100, shares: 89, comments: 156 }
                                }
                            ]
                        },
                        socialData: { data: [] },
                        timestamp: new Date().toISOString()
                    }
                ];
                
                localStorage.setItem('monitoringData', JSON.stringify(bmwData));
                localStorage.setItem('testMonitoringData', JSON.stringify(bmwData));
                
                log(`‚úÖ BMW data added successfully!

üöó Articles Added: ${bmwData[0].newsData.results.length}

üìã Articles:
1. BMW Electric Vehicle Technology (Breaking News, Positive)
2. BMW Record Sales Q4 2024 (Positive)  
3. BMW Safety Recall (Breaking News, Negative)

üéØ Next Steps:
1. Click "Test Dashboard"
2. Refresh the dashboard page
3. Check "Recent Activity" section
4. You should see BMW articles!

üí° The fix should now work:
- setArticles import added ‚úÖ
- Data transformation fixed ‚úÖ
- Articles match interface ‚úÖ`, 'success');
                
            } catch (error) {
                log(`‚ùå Error adding BMW data: ${error.message}`, 'error');
            }
        }
        
        function goToDashboard() {
            const dashboardUrl = window.location.origin + '/dashboard';
            window.open(dashboardUrl, '_blank');
            
            log(`üöÄ Dashboard opened: ${dashboardUrl}

üìã Test Instructions:
1. The dashboard should open in a new tab
2. Refresh the page (F5 or Ctrl+R)
3. Look at the "Recent Activity" section
4. You should see BMW articles displayed!

üîç Expected Results:
- Recent Activity shows 3 BMW articles
- Total Articles metric shows 3
- Sentiment breakdown shows positive/negative
- Breaking news indicators visible
- Engagement metrics displayed

üí° If you still see "No articles found":
- Check browser console for new error messages
- The setArticles error should be fixed now
- Look for "‚úÖ Monitoring data loaded from localStorage" message`, 'info');
        }
        
        function checkData() {
            const data = localStorage.getItem('monitoringData') || localStorage.getItem('testMonitoringData');
            
            if (data) {
                try {
                    const parsedData = JSON.parse(data);
                    const bmwData = parsedData.find(item => item.keyword === 'bmw');
                    
                    if (bmwData) {
                        const newsCount = bmwData.newsData?.results?.length || 0;
                        
                        log(`‚úÖ BMW data found in localStorage!

üìä Data Status:
- News Articles: ${newsCount}
- Last Updated: ${bmwData.timestamp ? new Date(bmwData.timestamp).toLocaleString() : 'Unknown'}

üìã Articles Ready:
${bmwData.newsData?.results?.map(article => `- ${article.title}`).join('\n') || 'No articles found'}

üéØ This data should now work in the dashboard with the fix applied!`, 'success');
                    } else {
                        log(`‚ùå No BMW data found.

üîß Please click "Add BMW Data" first.`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error reading data: ${error.message}`, 'error');
                }
            } else {
                log(`‚ùå No monitoring data found.

üîß Please click "Add BMW Data" first.`, 'error');
            }
        }
        
        // Auto-check data on page load
        window.addEventListener('load', () => {
            setTimeout(checkData, 500);
        });
    </script>
</body>
</html>
